import{_ as l,C as p,o as r,c as k,aA as t,E as n,w as e,j as s,a as h}from"./chunks/framework.DSs4OLzh.js";const b=JSON.parse('{"title":"Cardiac Cine MRI with Arrhythmias","description":"","frontmatter":{},"headers":[],"relativePath":"tutorial/07-RRVariability.md","filePath":"tutorial/07-RRVariability.md","lastUpdated":null}'),o={name:"tutorial/07-RRVariability.md"};function d(c,i,E,g,y,u){const a=p("center");return r(),k("div",null,[i[4]||(i[4]=t('<h1 id="Cardiac-Cine-MRI-with-Arrhythmias" tabindex="-1">Cardiac Cine MRI with Arrhythmias <a class="header-anchor" href="#Cardiac-Cine-MRI-with-Arrhythmias" aria-label="Permalink to &quot;Cardiac Cine MRI with Arrhythmias {#Cardiac-Cine-MRI-with-Arrhythmias}&quot;">‚Äã</a></h1><p><a href="./tutorial/07-RRVariability.jl"><img src="https://img.shields.io/badge/julia-script-9558B2?logo=julia" alt=""></a> <a href="./tutorial/07-RRVariability.ipynb"><img src="https://img.shields.io/badge/jupyter-notebook-blue?logo=jupyter" alt=""></a> <a href="https://mybinder.org/v2/gh/JuliaHealth/KomaMRI.jl/master?urlpath=git-pull%3Frepo%3Dhttps%253A%252F%252Fgithub.com%252FJuliaHealth%252FKomaMRI.jl%26urlpath%3Dlab%252Ftree%252FKomaMRI.jl%252Fdev%252Ftutorial%252F07-RRVariability.ipynb%26branch%3Dgh-pages" target="_blank" rel="noreferrer"><img src="https://mybinder.org/badge_logo.svg" alt=""></a></p><p>This tutorial shows how to simulate cardiac cine MRI using Koma, including cases with variable RR intervals (i.e., arrhythmias). You&#39;ll learn how to:</p><ol><li><p>Simulate a clean cine acquisition with constant RR intervals.</p></li><li><p>Introduce arrhythmias (variable RR intervals) into the cardiac phantom.</p></li><li><p>Observe how this desynchronization degrades image quality.</p></li><li><p>Correct the acquisition by synchronizing the sequence with the phantom‚Äôs RR variability (manual triggering).</p></li></ol><h3 id="1.-Constant-RR-for-Phantom-and-Sequence" tabindex="-1">1. Constant RR for Phantom and Sequence <a class="header-anchor" href="#1.-Constant-RR-for-Phantom-and-Sequence" aria-label="Permalink to &quot;1. Constant RR for Phantom and Sequence {#1.-Constant-RR-for-Phantom-and-Sequence}&quot;">‚Äã</a></h3><p>We will begin by simulating a cardiac cine on a myocardial phantom with a constant RR interval. We&#39;ll use the <code>heart_phantom</code> function to create a ring-shaped phantom filled with blood, resembling the left ventricle:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> heart_phantom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>By default, this phantom exhibits periodic contraction and rotation with a 1-second period:</p>',8)),n(a,null,{default:e(()=>[...i[0]||(i[0]=[s("object",{type:"text/html",data:"../../assets/tut-6-phantom1.html",style:{width:"90%",height:"470px"}},null,-1)])]),_:1}),i[5]||(i[5]=t(`<p>As shown in previous tutorials, the phantom&#39;s motion is defined by its <code>motion</code> field. Until now, this motion has typically consisted of a single <code>Motion</code> component. In this case, however, it consists of two independent motions: a contraction (<code>HeartBeat</code>) and a <code>Rotation</code>. These two are grouped together in a <code>MotionList</code> structure:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motion</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>MotionList{Float64}(Motion{Float64}[Motion{Float64}</span></span>
<span class="line"><span>  action: HeartBeat{Float64}</span></span>
<span class="line"><span>  time: TimeCurve{Float64}</span></span>
<span class="line"><span>  spins: AllSpins AllSpins()</span></span>
<span class="line"><span>, Motion{Float64}</span></span>
<span class="line"><span>  action: Rotate{Float64}</span></span>
<span class="line"><span>  time: TimeCurve{Float64}</span></span>
<span class="line"><span>  spins: AllSpins AllSpins()</span></span>
<span class="line"><span>])</span></span></code></pre></div><p>Now, we will create a bSSFP cine sequence with the following parameters:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RRs          </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [s] constant RR interval</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N_matrix     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # image size = N x N</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">N_phases     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 25</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # Number of cardiac phases</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FOV          </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.11</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # [m]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TR           </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 25e-3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # [s]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flip_angle   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # [¬∫]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">adc_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.2e-3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [s]</span></span></code></pre></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">seq </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bSSFP_cine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FOV, N_matrix, TR, flip_angle, RRs, N_phases, sys;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    N_dummy_cycles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 40</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, adc_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adc_duration,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>The simulation and subsequent reconstruction produces the following cine frames, which look clean and temporally coherent:</p>`,7)),n(a,null,{default:e(()=>[...i[1]||(i[1]=[s("object",{data:"../../assets/tut-7-frames1.gif",style:{width:"100%","max-width":"325px"}},null,-1)])]),_:1}),i[6]||(i[6]=t(`<h3 id="2.-Arrhythmic-Phantom:-Variable-RR,-Constant-Sequence" tabindex="-1">2. Arrhythmic Phantom: Variable RR, Constant Sequence <a class="header-anchor" href="#2.-Arrhythmic-Phantom:-Variable-RR,-Constant-Sequence" aria-label="Permalink to &quot;2. Arrhythmic Phantom: Variable RR, Constant Sequence {#2.-Arrhythmic-Phantom:-Variable-RR,-Constant-Sequence}&quot;">‚Äã</a></h3><p>Now, we will introduce arrhythmias into the phantom by varying its RR intervals. However, the sequence will still assume a constant RR interval of 1 second.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RRs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>The <code>RRs</code> array contains <strong>scaling factors</strong> relative to the original duration of the phantom‚Äôs motion cycle.</p><p>In this example, the base duration of the cardiac motion is 1 second, which is defined within the <code>t</code> field of its <a href="/KomaMRI.jl/previews/PR725/explanation/3-phantom-format#TimeCurve"><code>TimeCurve</code></a> structure. Consequently, the elements in <code>RRs</code> directly represent the actual RR intervals in seconds (e.g., 0.9 s, 1.1 s, etc.).</p></div><p>Let&#39;s apply the new <code>RRs</code> to the phantom:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Take the time curve from the contraction motion:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t_curve </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generate a new time curve:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t_curve_new </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TimeCurve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t_curve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    t_unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t_curve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">t_unit,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    periodic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    periods </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RRs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Assign the new time curve to both the contraction and the rotation:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t_curve_new</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">motions[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t_curve_new;</span></span></code></pre></div><p>Let‚Äôs visualize how the motion pattern has changed, now with variable-duration RR intervals:</p>`,7)),n(a,null,{default:e(()=>[...i[2]||(i[2]=[s("object",{type:"text/html",data:"../../assets/tut-6-phantom2.html",style:{width:"90%",height:"470px"}},null,-1)])]),_:1}),i[7]||(i[7]=t(`<p>Since the sequence still assumes a constant RR interval, it becomes unsynchronized with the phantom. This results in artifacts and temporal inconsistencies in the cine images. We will showcase these images in the next section.</p><h3 id="3.-Prospective-Triggering:-Resynchronized-Acquisition" tabindex="-1">3. Prospective Triggering: Resynchronized Acquisition <a class="header-anchor" href="#3.-Prospective-Triggering:-Resynchronized-Acquisition" aria-label="Permalink to &quot;3. Prospective Triggering: Resynchronized Acquisition {#3.-Prospective-Triggering:-Resynchronized-Acquisition}&quot;">‚Äã</a></h3><p>To correct this, we synchronize the sequence <strong>manually</strong> by providing it the same RR intervals as the phantom:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">seq </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bSSFP_cine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FOV, N_matrix, TR, flip_angle, RRs, N_phases, sys;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    N_dummy_cycles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 40</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, adc_duration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> adc_duration,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>This approach manually mimics cardiac triggering. The resulting cine is once again correctly aligned, despite the underlying arrhythmia.</p><p>In the future, this synchronization will be handled automatically through upcoming support for trigger extensions in the sequence framework.</p><p>Below, we compare the results of the desynchronized üëé acquisition simulated in the previous section with the resynchronized üïê acquisition:</p>`,7)),n(a,null,{default:e(()=>[...i[3]||(i[3]=[s("object",{data:"../../assets/tut-7-frames_comparison.gif",style:{width:"100%"}},null,-1)])]),_:1}),i[8]||(i[8]=s("hr",null,null,-1)),i[9]||(i[9]=s("p",null,[s("em",null,[h("This page was generated using "),s("a",{href:"https://github.com/fredrikekre/Literate.jl",target:"_blank",rel:"noreferrer"},"Literate.jl"),h(".")])],-1))])}const F=l(o,[["render",d]]);export{b as __pageData,F as default};
