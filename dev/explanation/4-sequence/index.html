<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sequence ¬∑ KomaMRI.jl</title><meta name="title" content="Sequence ¬∑ KomaMRI.jl"/><meta property="og:title" content="Sequence ¬∑ KomaMRI.jl"/><meta property="twitter:title" content="Sequence ¬∑ KomaMRI.jl"/><meta name="description" content="Documentation for KomaMRI.jl."/><meta property="og:description" content="Documentation for KomaMRI.jl."/><meta property="twitter:description" content="Documentation for KomaMRI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/hide-documenter-example-output.css" rel="stylesheet" type="text/css"/><link href="../../assets/center-images.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="KomaMRI.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="KomaMRI.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">üè† Home</a></li><li><a class="tocitem" href="../../how-to/1-getting-started/">üèÉ Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">üèãÔ∏è Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial/01-FID/">Free Induction Decay</a></li><li><a class="tocitem" href="../../tutorial/02-SmallTipApproximation/">Small Tip Angle Approximation</a></li><li><a class="tocitem" href="../../tutorial/03-ChemicalShiftEPI/">Chemical Shift in an EPI sequence</a></li><li><a class="tocitem" href="../../tutorial/04-3DSliceSelective/">Slice-Selective Acquisition of 3D Phantom</a></li><li><a class="tocitem" href="../../tutorial/05-SimpleMotion/">Patient&#39;s Motion During Acquisition</a></li><li><a class="tocitem" href="../../tutorial/06-DiffusionMotion/">Diffusion-induced Signal Attenuation</a></li><li><a class="tocitem" href="../../tutorial/07-RRVariability/">Cardiac Cine MRI with Arrhythmias</a></li><li><a class="tocitem" href="../../tutorial/07-label/">Using Labels to reconstruct multi-slice / multi-contrast sequences</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">üßë‚Äçüî¨ Reproducible Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial-pluto/01-gradient-echo-spin-echo/">Understanding basic MRI sequences</a></li><li><a class="tocitem" href="../../tutorial-pluto/02-low-field-cmra-optimization/">Low-Field CMRA Optimization</a></li><li><a class="tocitem" href="../../tutorial-pluto/03-low-field-boost-optimization/">Low-Field BOOST Optimization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">üë®‚Äçüç≥ How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../how-to/2-1-use-koma-ui/">Use Koma&#39;s User Interface</a></li><li><a class="tocitem" href="../../how-to/2-2-use-koma-notebooks/">Use Koma in Notebooks</a></li><li><a class="tocitem" href="../../how-to/2-3-use-koma-scripts/">Use Koma in Julia Scripts</a></li><li><a class="tocitem" href="../../how-to/3-create-your-own-phantom/">Create Your Own Phantom</a></li><li><a class="tocitem" href="../../how-to/3-create-your-own-sequence/">Create Your Own Sequence</a></li><li><a class="tocitem" href="../../how-to/4-run-distributed-simulations/">Run Distributed Simulations</a></li><li><a class="tocitem" href="../../how-to/5-contribute-to-koma/">Contribute to Koma</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox" checked/><label class="tocitem" for="menuitem-6"><span class="docs-label">ü§î Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../1-phantom/">Phantom</a></li><li><a class="tocitem" href="../2-motion/">Motion</a></li><li><a class="tocitem" href="../3-phantom-format/">Phantom File Format</a></li><li class="is-active"><a class="tocitem" href>Sequence</a><ul class="internal"><li><a class="tocitem" href="#KomaMRI-Sequence-Overview"><span>KomaMRI Sequence Overview</span></a></li><li><a class="tocitem" href="#Concatenation-of-Sequences"><span>Concatenation of Sequences</span></a></li></ul></li><li><a class="tocitem" href="../5-seq-events/">Sequence Events</a></li><li><a class="tocitem" href="../6-simulation/">Simulation</a></li><li><a class="tocitem" href="../7-gpu-explanation/">GPU Parallelization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">üë®‚Äçüíª Reference Guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/1-api/">API Overview</a></li><li><a class="tocitem" href="../../reference/2-koma-base/">KomaMRIBase</a></li><li><a class="tocitem" href="../../reference/3-koma-core/">KomaMRICore</a></li><li><a class="tocitem" href="../../reference/4-koma-files/">KomaMRIFiles</a></li><li><a class="tocitem" href="../../reference/5-koma-plots/">KomaMRIPlots</a></li><li><a class="tocitem" href="../../reference/6-koma-mri/">KomaMRI</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">ü§î Explanations</a></li><li class="is-active"><a href>Sequence</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sequence</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaHealth/KomaMRI.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaHealth/KomaMRI.jl/blob/master/docs/src/explanation/4-sequence.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Sequence"><a class="docs-heading-anchor" href="#Sequence">Sequence</a><a id="Sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Sequence" title="Permalink"></a></h1><p>This section delves into some details about how a sequence is constructed. The sequence definition in <strong>KomaMRI</strong> is strongly related to the <a href="https://pulseq.github.io/index.html">Pulseq</a> definition. After reading this section, you should be able to create your own <strong>Sequence</strong> structs for conducting custom simulations using the <strong>KomaMRI</strong> package.</p><h2 id="KomaMRI-Sequence-Overview"><a class="docs-heading-anchor" href="#KomaMRI-Sequence-Overview">KomaMRI Sequence Overview</a><a id="KomaMRI-Sequence-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#KomaMRI-Sequence-Overview" title="Permalink"></a></h2><p>Let&#39;s introduce the following simple sequence figure to expand from a visual example to a more general sequence definition:</p><p align="center"><img width="80%" src="../../assets/sequence-diagram.svg"/></p><p>A <strong>sequence</strong> can be thought of as an ordered concatenation of blocks over time. Each block is essentially a sequence with a length of 1. Every block consists of an <strong>RF</strong> pulse, the <span>$(x,y,z)$</span> <strong>gradients</strong>, and the <strong>acquisition</strong> of samples. Each block also has an associated time <strong>duration</strong>. To simplify, we will refer to these components as follows:</p><p class="math-container">\[\begin{matrix*}[l]
\text{seq[i]}      &amp;: &amp; \text{block i of the sequence} \\
\text{seq.RF[i]}   &amp;: &amp; \text{RF pulse at the i block} \\
\text{seq.GR.x[i]} &amp;: &amp; \text{gradient x at the i block} \\
\text{seq.GR.y[i]} &amp;: &amp; \text{gradient y at the i block} \\
\text{seq.GR.z[i]} &amp;: &amp; \text{gradient z at the i block} \\
\text{seq.ADC[i]}  &amp;: &amp; \text{acquisition at the i block} \\
\text{seq.DUR[i]}  &amp;: &amp; \text{duration at the i block}
\end{matrix*}\]</p><p>The best way to understand the <strong>Sequence</strong> struct in <strong>KomaMRI</strong> is by examining the source code where this struct is defined:</p><pre><code class="language-julia hljs">mutable struct Sequence
    GR::Array{Grad,2}
    RF::Array{RF,2}
    ADC::Array{ADC,1}
    DUR::Array{Float64,1}
    EXT::Vector{Vector{Extension}}
    DEF::Dict{String,Any}
end</code></pre><p>As you can see, a <strong>Sequence</strong> struct contains 6 field names: &#39;&#39;DEF&#39;&#39; contains information for reconstruction steps (so it is not mandatory to fill it), &#39;&#39;DUR&#39;&#39; is a vector that contains the time durations of each block, &#39;&#39;ADC&#39;&#39; is also a vector with the acquisition samples for every block (a vector of <strong>ADC</strong> structs), &#39;&#39;GR&#39;&#39; is a 2D matrix which 3 rows representing the x-y-z gradients and columns having the samples of each block (a matrix of <strong>Grad</strong> structs), &#39;&#39;RF&#39;&#39; is also a 2D matrix where each row represents a different coil and the columns are for different block samples too (a matrix of <strong>RF</strong> structs), and &#39;&#39;EXT&#39;&#39; is a vector of vectors containing extensions for each block, currently it is used to manage labels of a sequence required if you want to fill metadata headers of the MRD format. The <strong>RF</strong>, <strong>Grad</strong>, and <strong>ADC</strong> are MRI events that will be explained in the section <a href="../5-seq-events/">Events Definitions</a>.</p><div class="admonition is-warning" id="Warning-345ae88ec7047234"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-345ae88ec7047234" title="Permalink"></a></header><div class="admonition-body"><p>So far, <strong>KomaMRI</strong> can only manage one coil for RF excitations. However, in future versions, parallel transmit pTX will be managed by adding more ``rows&#39;&#39; to the RF matrix of the Sequence field name.</p></div></div><p>In order to understand how a <strong>Sequence</strong> struct can be manipulated in <strong>Julia</strong>, let&#39;s use the EPI sequence example. You can display basic information of the <strong>Sequence</strong> variable in the <strong>Julia REPL</strong>:</p><pre><code class="language-julia-repl hljs">julia&gt; seq = PulseDesigner.EPI_example()
Sequence[ œÑ = 62.846 ms | blocks: 204 | ADC: 101 | GR: 205 | RF: 1 | EXT: 0 | DEF: 5 ]</code></pre><p>As you can see, this <strong>Sequence</strong> has 204 blocks, 1 of these blocks has an <strong>RF</strong> struct with values different from zero, there are 205 number of <strong>Grad</strong> structs considering the x-y-z components, 101 <strong>ADC</strong> structs acquire samples of some blocks and 62.846 ms is the total time duration of the complete <strong>Sequence</strong>.</p><p>To display the sequence in an graph, we can use the <a href="../../reference/5-koma-plots/#KomaMRIPlots.plot_seq"><code>plot_seq</code></a> function:</p><pre><code class="language-julia-repl hljs">julia&gt; plot_seq(seq; slider=false)</code></pre><object type="text/html" data="../../assets/seq-epi-example-full.html" style="width:100%; height:420px;"></object><p>This way, you can see exactly where the <strong>RF</strong>, <strong>Grad</strong> and <strong>ADC</strong> structs are located in time.</p><p>You can access and filter information for the <strong>RF</strong>, <strong>Grad</strong>, <strong>ADC</strong>, and <strong>DUR</strong> field names of a <strong>Sequence</strong> using the dot notation. This allows you to display helpful information about the organization of the <strong>Sequence</strong> struct:</p><pre><code class="language-julia-repl hljs">julia&gt; seq.RF
1√ó204 Matrix{RF}:
 ‚äì(0.5872 ms)  ‚áø(0.0 ms)  ‚áø(0.0 ms)  ‚Ä¶  ‚áø(0.0 ms)  ‚áø(0.0 ms)   

julia&gt; seq.GR
3√ó204 Matrix{Grad}:
 ‚áø(0.5872 ms)  ‚äì(0.4042 ms)  ‚äì(0.4042 ms)  ‚Ä¶  ‚áø(0.2062 ms)  ‚äì(0.4042 ms)  ‚äì(0.4042 ms)
 ‚áø(0.5872 ms)  ‚äì(0.4042 ms)  ‚áø(0.4042 ms)     ‚äì(0.2062 ms)  ‚áø(0.4042 ms)  ‚äì(0.4042 ms)
 ‚áø(0.5872 ms)  ‚áø(0.0 ms)     ‚áø(0.0 ms)        ‚áø(0.0 ms)     ‚áø(0.0 ms)     ‚áø(0.0 ms)

julia&gt; seq.ADC
204-element Vector{ADC}:
 ADC(0, 0.0, 0.0, 0.0, 0.0)
 ADC(0, 0.0, 0.0, 0.0, 0.0)
 ADC(101, 0.00019999999999999998, 0.00010211565434713023, 0.0, 0.0)
 ‚ãÆ
 ADC(101, 0.00019999999999999998, 0.00010211565434713023, 0.0, 0.0)
 ADC(0, 0.0, 0.0, 0.0, 0.0)

julia&gt; seq.DUR
204-element Vector{Float64}:
 0.0005871650124959989
 0.0004042313086942605
 0.0004042313086942605
 ‚ãÆ
 0.0004042313086942605
 0.0004042313086942605</code></pre><p>Additionally, you can access a subset of blocks in a <strong>Sequence</strong> by slicing or indexing. The result will also be a <strong>Sequence</strong> struct, allowing you to perform the same operations as you would with a full Sequence (just a heads-up: this is analogous for the <a href="../1-phantom/">Phantom</a> structure). For example, if you want to analyze the first 11 blocks, you can do the following:</p><pre><code class="language-julia-repl hljs">julia&gt; seq[1:11]
Sequence[ œÑ = 3.837 ms | blocks: 11 | ADC: 5 | GR: 11 | RF: 1 | DEF: 5 ]

julia&gt; seq[1:11].GR
3√ó11 Matrix{Grad}:
 ‚áø(0.5872 ms)  ‚äì(0.4042 ms)  ‚äì(0.4042 ms)   ‚Ä¶  ‚äì(0.4042 ms)  ‚áø(0.2062 ms)  ‚äì(0.4042 ms)
 ‚áø(0.5872 ms)  ‚äì(0.4042 ms)  ‚áø(0.4042 ms)      ‚áø(0.4042 ms)  ‚äì(0.2062 ms)  ‚áø(0.4042 ms)
 ‚áø(0.5872 ms)  ‚áø(0.0 ms)     ‚áø(0.0 ms)        ‚áø(0.0 ms)     ‚áø(0.0 ms)     ‚áø(0.0 ms)

julia&gt; plot_seq(seq[1:11]; slider=false)</code></pre><object type="text/html" data="../../assets/seq-epi-example-some-blocks.html" style="width:100%; height:420px;"></object><h2 id="Concatenation-of-Sequences"><a class="docs-heading-anchor" href="#Concatenation-of-Sequences">Concatenation of Sequences</a><a id="Concatenation-of-Sequences-1"></a><a class="docs-heading-anchor-permalink" href="#Concatenation-of-Sequences" title="Permalink"></a></h2><p>Sequences can be concatenated side by side. The example below demonstrates how to concatenate sequences:</p><pre><code class="language-julia-repl hljs">julia&gt; s = PulseDesigner.EPI_example()[1:11]
Sequence[ œÑ = 3.837 ms | blocks: 11 | ADC: 5 | GR: 11 | RF: 1 | DEF: 5 ]

julia&gt; seq = s + s + s
Sequence[ œÑ = 11.512 ms | blocks: 33 | ADC: 15 | GR: 33 | RF: 3 | DEF: 5 ]

julia&gt; plot_seq(seq; slider=false)</code></pre><object type="text/html" data="../../assets/seq-concatenation.html" style="width:100%; height:420px;"></object></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3-phantom-format/">¬´ Phantom File Format</a><a class="docs-footer-nextpage" href="../5-seq-events/">Sequence Events ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 14 February 2026 23:52">Saturday 14 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
