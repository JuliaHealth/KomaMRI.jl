<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Use Koma in Julia Scripts ¬∑ KomaMRI.jl</title><meta name="title" content="Use Koma in Julia Scripts ¬∑ KomaMRI.jl"/><meta property="og:title" content="Use Koma in Julia Scripts ¬∑ KomaMRI.jl"/><meta property="twitter:title" content="Use Koma in Julia Scripts ¬∑ KomaMRI.jl"/><meta name="description" content="Documentation for KomaMRI.jl."/><meta property="og:description" content="Documentation for KomaMRI.jl."/><meta property="twitter:description" content="Documentation for KomaMRI.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/hide-documenter-example-output.css" rel="stylesheet" type="text/css"/><link href="../../assets/center-images.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="KomaMRI.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="KomaMRI.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">üè† Home</a></li><li><a class="tocitem" href="../1-getting-started/">üèÉ Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">üèãÔ∏è Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial/01-FID/">Free Induction Decay</a></li><li><a class="tocitem" href="../../tutorial/02-SmallTipApproximation/">Small Tip Angle Approximation</a></li><li><a class="tocitem" href="../../tutorial/03-ChemicalShiftEPI/">Chemical Shift in an EPI sequence</a></li><li><a class="tocitem" href="../../tutorial/04-3DSliceSelective/">Slice-Selective Acquisition of 3D Phantom</a></li><li><a class="tocitem" href="../../tutorial/05-SimpleMotion/">Patient&#39;s Motion During Acquisition</a></li><li><a class="tocitem" href="../../tutorial/06-DiffusionMotion/">Diffusion-induced Signal Attenuation</a></li><li><a class="tocitem" href="../../tutorial/07-RRVariability/">Cardiac Cine MRI with Arrhythmias</a></li><li><a class="tocitem" href="../../tutorial/07-label/">Using Labels to reconstruct multi-slice / multi-contrast sequences</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">üßë‚Äçüî¨ Reproducible Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial-pluto/01-gradient-echo-spin-echo/">Understanding basic MRI sequences</a></li><li><a class="tocitem" href="../../tutorial-pluto/02-low-field-cmra-optimization/">Low-Field CMRA Optimization</a></li><li><a class="tocitem" href="../../tutorial-pluto/03-low-field-boost-optimization/">Low-Field BOOST Optimization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox" checked/><label class="tocitem" for="menuitem-5"><span class="docs-label">üë®‚Äçüç≥ How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../2-1-use-koma-ui/">Use Koma&#39;s User Interface</a></li><li><a class="tocitem" href="../2-2-use-koma-notebooks/">Use Koma in Notebooks</a></li><li class="is-active"><a class="tocitem" href>Use Koma in Julia Scripts</a><ul class="internal"><li><a class="tocitem" href="#Basic-Workflow"><span>Basic Workflow</span></a></li><li><a class="tocitem" href="#Loading-Simulation-Inputs"><span>Loading Simulation Inputs</span></a></li><li><a class="tocitem" href="#Running-Simulation"><span>Running Simulation</span></a></li><li><a class="tocitem" href="#Reconstructing-Image-using-MRIReco"><span>Reconstructing Image using MRIReco</span></a></li><li><a class="tocitem" href="#Exporting-Results-to-.mat-File"><span>Exporting Results to .mat File</span></a></li></ul></li><li><a class="tocitem" href="../3-create-your-own-phantom/">Create Your Own Phantom</a></li><li><a class="tocitem" href="../3-create-your-own-sequence/">Create Your Own Sequence</a></li><li><a class="tocitem" href="../4-run-distributed-simulations/">Run Distributed Simulations</a></li><li><a class="tocitem" href="../5-contribute-to-koma/">Contribute to Koma</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">ü§î Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../explanation/1-phantom/">Phantom</a></li><li><a class="tocitem" href="../../explanation/2-motion/">Motion</a></li><li><a class="tocitem" href="../../explanation/3-phantom-format/">Phantom File Format</a></li><li><a class="tocitem" href="../../explanation/4-sequence/">Sequence</a></li><li><a class="tocitem" href="../../explanation/5-seq-events/">Sequence Events</a></li><li><a class="tocitem" href="../../explanation/6-simulation/">Simulation</a></li><li><a class="tocitem" href="../../explanation/7-gpu-explanation/">GPU Parallelization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">üë®‚Äçüíª Reference Guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/1-api/">API Overview</a></li><li><a class="tocitem" href="../../reference/2-koma-base/">KomaMRIBase</a></li><li><a class="tocitem" href="../../reference/3-koma-core/">KomaMRICore</a></li><li><a class="tocitem" href="../../reference/4-koma-files/">KomaMRIFiles</a></li><li><a class="tocitem" href="../../reference/5-koma-plots/">KomaMRIPlots</a></li><li><a class="tocitem" href="../../reference/6-koma-mri/">KomaMRI</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">üë®‚Äçüç≥ How to</a></li><li class="is-active"><a href>Use Koma in Julia Scripts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Use Koma in Julia Scripts</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaHealth/KomaMRI.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaHealth/KomaMRI.jl/blob/master/docs/src/how-to/2-3-use-koma-scripts.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Use-Koma-in-Julia-Scripts"><a class="docs-heading-anchor" href="#Use-Koma-in-Julia-Scripts">Use Koma in Julia Scripts</a><a id="Use-Koma-in-Julia-Scripts-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Koma-in-Julia-Scripts" title="Permalink"></a></h1><p>You should already be familiar with the  <a href="../2-1-use-koma-ui/">Graphical User Interface</a> of <strong>KomaMRI</strong>. However, you can also use this package directly from the <strong>Julia REPL</strong> or write your own Julia scripts. This allows you to unlock the full potential of KomaMRI, enabling you to utilize more of its functionalities and even test your own MRI ideas.</p><p>This section demonstrates a basic workflow with <strong>KomaMRI</strong> through writing your own scripts or entering commands directly into the <strong>Julia REPL</strong>. Let&#39;s begin.</p><h2 id="Basic-Workflow"><a class="docs-heading-anchor" href="#Basic-Workflow">Basic Workflow</a><a id="Basic-Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Workflow" title="Permalink"></a></h2><p>(You can also go to <a href="../2-1-use-koma-ui/#Basic-Workflow">analog steps using UI</a>)</p><p>As a general overview, remember the following workflow steps when using KomaMRI:</p><ul><li>Loading Simulation Inputs: <strong>Scanner</strong>, <strong>Phantom</strong>, <strong>Sequence</strong></li><li>Running Simulation</li><li>Reconstructing Image using <strong>MRIReco</strong></li></ul><p>Let&#39;s replicate these previous steps in a <strong>Julia</strong> script. You will obtain the following code, which you can copy and paste into the <strong>Julia REPL</strong>:</p><pre><code class="language-julia hljs"># Import the package
using KomaMRI

# Define scanner, object and sequence
sys = Scanner()
obj = brain_phantom2D()
seq = PulseDesigner.EPI_example()

# Define simulation parameters and perform simulation
sim_params = KomaMRICore.default_sim_params() 
raw = simulate(obj, seq, sys; sim_params)

# Auxiliary function for reconstruction
function reconstruct_2d_image(raw::RawAcquisitionData)
    acqData = AcquisitionData(raw)
    acqData.traj[1].circular = false #Removing circular window
    C = maximum(2*abs.(acqData.traj[1].nodes[:]))  #Normalize k-space to -.5 to .5 for NUFFT
    acqData.traj[1].nodes = acqData.traj[1].nodes[1:2,:] ./ C
    Nx, Ny = raw.params[&quot;reconSize&quot;][1:2]
    recParams = Dict{Symbol,Any}()
    recParams[:reconSize] = (Nx, Ny)
    recParams[:densityWeighting] = true
    rec = reconstruction(acqData, recParams)
    image3d  = reshape(rec.data, Nx, Ny, :)
    image2d = (abs.(image3d) * prod(size(image3d)[1:2]))[:,:,1]
    return image2d
end

# Perform reconstruction to get the image
image = reconstruct_2d_image(raw)</code></pre><p>Let&#39;s go through this script step by step.</p><h2 id="Loading-Simulation-Inputs"><a class="docs-heading-anchor" href="#Loading-Simulation-Inputs">Loading Simulation Inputs</a><a id="Loading-Simulation-Inputs-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-Simulation-Inputs" title="Permalink"></a></h2><p>(You can also go to <a href="../2-1-use-koma-ui/#Loading-Simulation-Inputs">analog steps using UI</a>)</p><p>The inputs of the simulation are created in the following part of the script: </p><pre><code class="language-julia hljs"># Define scanner, object and sequence
sys = Scanner()
obj = brain_phantom2D()
seq = PulseDesigner.EPI_example()</code></pre><h3 id="Scanner"><a class="docs-heading-anchor" href="#Scanner">Scanner</a><a id="Scanner-1"></a><a class="docs-heading-anchor-permalink" href="#Scanner" title="Permalink"></a></h3><p>The previously created <strong>Scanner</strong> struct contains default parameters. In your initial simulations, you will likely use this default struct without making any modifications. You can view all the parameters by displaying the struct variable in the <strong>Julia REPL</strong>. The Scanner&#39;s parameters include hardware limitations such as the main magnetic field, maximum gradient values, minimum raster times, and more. You may want to adjust these values for your future custom simulations.</p><pre><code class="language-julia-repl hljs">julia&gt; sys
Scanner
  B0: Float64 1.5
  B1: Float64 1.0e-5
  Gmax: Float64 0.06
  Smax: Int64 500
  ADC_Œît: Float64 2.0e-6
  seq_Œît: Float64 1.0e-5
  GR_Œît: Float64 1.0e-5
  RF_Œît: Float64 1.0e-6
  RF_ring_down_T: Float64 2.0e-5
  RF_dead_time_T: Float64 0.0001
  ADC_dead_time_T: Float64 1.0e-5</code></pre><h3 id="Phantom"><a class="docs-heading-anchor" href="#Phantom">Phantom</a><a id="Phantom-1"></a><a class="docs-heading-anchor-permalink" href="#Phantom" title="Permalink"></a></h3><p>The Phantom struct created in this example represents a slice of a brain. To create it, we use the function <code>brain_phantom2D</code>, which is part of the subdependency <strong>KomaMRICore</strong>. While <strong>KomaMRI</strong> provides some phantom examples for experimentation, you may also want to create your custom <strong>Phantom</strong> struct tailored to your specific requirements.</p><p>The <strong>Phantom</strong> struct contains MRI parameters related to the magnetization properties of an object. These parameters include magnetization positions, proton density, relaxation times, off-resonance, among others. For more information about Koma&#39;s Phantom and what it can do, as well as how to store and share it, check out the <a href="../../explanation/1-phantom/">Phantom</a> section. To view all the keys and values of the object, you can do so in the <strong>Julia REPL</strong> as follows:</p><pre><code class="language-julia-repl hljs">julia&gt; obj
Phantom{Float64}
  name: String &quot;brain2D_axial&quot;
  x: Array{Float64}((6506,)) [-0.084, -0.084,  ‚Ä¶  0.086, 0.086]
  y: Array{Float64}((6506,)) [-0.03, -0.028,  ‚Ä¶  0.0, 0.002]
  z: Array{Float64}((6506,)) [-0.0, -0.0,  ‚Ä¶  0.0, 0.0]
  œÅ: Array{Float64}((6506,)) [0.7, 0.7,  ‚Ä¶  0.7, 0.7]
  T1: Array{Float64}((6506,)) [0.569, 0.569,  ‚Ä¶  0.569, 0.569]
  T2: Array{Float64}((6506,)) [0.329, 0.329,  ‚Ä¶  0.329, 0.329]
  T2s: Array{Float64}((6506,)) [0.058, 0.058,  ‚Ä¶  0.058, 0.058]
  Œîw: Array{Float64}((6506,)) [-0.0, -0.0,  ‚Ä¶  -0.0, -0.0]
  DŒª1: Array{Float64}((6506,)) [0.0, 0.0,  ‚Ä¶  0.0, 0.0]
  DŒª2: Array{Float64}((6506,)) [0.0, 0.0,  ‚Ä¶  0.0, 0.0]
  DŒ∏: Array{Float64}((6506,)) [0.0, 0.0,  ‚Ä¶  0.0, 0.0]
  motion: NoMotion{Float64} NoMotion{Float64}()
...</code></pre><p>You can also visualize the <strong>Phantom</strong> struct using the <a href="../../reference/5-koma-plots/#KomaMRIPlots.plot_phantom_map"><code>plot_phantom_map</code></a> function:</p><pre><code class="language-julia-repl hljs">julia&gt; plot_phantom_map(obj, :œÅ)</code></pre><object type="text/html" data="../../assets/phantom-rho.html" style="width:100%; height:620px;"></object><p>To utilize test phantoms included with <strong>KomaMRI</strong>, navigate to the &quot;examples&quot; folder and use the <a href="../../reference/4-koma-files/#KomaMRIFiles.read_phantom_jemris"><code>read_phantom_jemris</code></a>  function to read a phantom in <code>.h5</code> format. The following steps outline how to do this in <strong>Julia</strong>:</p><pre><code class="language-julia-repl hljs">julia&gt; path_koma = dirname(dirname(pathof(KomaMRI)))
julia&gt; path_sphere = joinpath(path_koma, &quot;examples&quot;, &quot;2.phantoms&quot;, &quot;sphere_chemical_shift.h5&quot;)
julia&gt; sphere = read_phantom_jemris(path_sphere)
julia&gt; plot_phantom_map(sphere, :T2)</code></pre><object type="text/html" data="../../assets/phantom-T2-circle.html" style="width:100%; height:620px;"></object><h3 id="Sequence"><a class="docs-heading-anchor" href="#Sequence">Sequence</a><a id="Sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Sequence" title="Permalink"></a></h3><p>The <strong>Sequence</strong> struct in the example represents one of the most basic MRI sequences. It excites the object with a 90¬∞ RF pulse and then uses EPI gradients to fill the k-space in a &quot;square&quot; manner. While you may want to create your sequences for experiments, you can always use some of the examples already available in <strong>KomaMRI</strong>.</p><p>In MRI, the sequence must be carefully designed with precise timing to obtain an image. It includes subcomponents such as gradients, radio-frequency excitation signals, and sample acquisition. For more information on constructing a <strong>Sequence</strong> struct, refer to the <a href="../../explanation/4-sequence/">Sequence</a> section.</p><p>You can view general information about a <strong>Sequence</strong> struct by displaying it in the <strong>Julia REPL</strong>:</p><pre><code class="language-julia-repl hljs">julia&gt; seq
Sequence[ œÑ = 62.846 ms | blocks: 204 | ADC: 101 | GR: 205 | RF: 1 | DEF: 5 ]</code></pre><p>For more precise timing checks, you can use the <a href="../../reference/5-koma-plots/#KomaMRIPlots.plot_seq"><code>plot_seq</code></a> function:</p><pre><code class="language-julia-repl hljs">julia&gt; plot_seq(seq; range=[0 30])</code></pre><object type="text/html" data="../../assets/plot-seq-epi.html" style="width:100%; height:420px;"></object><p>It is important to consider how the sequence traverses through k-space. The <a href="../../reference/5-koma-plots/#KomaMRIPlots.plot_kspace"><code>plot_kspace</code></a> function does precisely that:</p><pre><code class="language-julia-repl hljs">julia&gt; plot_kspace(seq)</code></pre><object type="text/html" data="../../assets/kspace-epi.html" style="width:100%; height:420px;"></object><p>Additionally, there are helpful sequence construction functions within a submodule of <strong>KomaMRI</strong> called <strong>PulseDesigner</strong>. These functions include <a href="../../reference/2-koma-base/#KomaMRIBase.PulseDesigner.RF_hard"><code>PulseDesigner.RF_hard</code></a>, <a href="../../reference/2-koma-base/#KomaMRIBase.PulseDesigner.RF_sinc"><code>PulseDesigner.RF_sinc</code></a>, <a href="../../reference/2-koma-base/#KomaMRIBase.PulseDesigner.EPI"><code>PulseDesigner.EPI</code></a>, <a href="../../reference/2-koma-base/#KomaMRIBase.PulseDesigner.radial_base"><code>PulseDesigner.radial_base</code></a> and <a href="../../reference/2-koma-base/#KomaMRIBase.PulseDesigner.spiral_base"><code>PulseDesigner.spiral_base</code></a>. For more details on how to use them, refer to the <a href="../../reference/1-api/">API documentation</a>.</p><p><strong>KomaMRI</strong> is also compatible with <a href="https://pulseq.github.io/">Pulseq</a>. The package installation includes some <code>.seq</code> files in <strong>Pulseq</strong> format, which can be read and used as a <strong>Sequence</strong> struct. Here&#39;s how to read a spiral <strong>Pulseq</strong> file stored in the &quot;examples&quot; folder of <strong>KomaMRI</strong>:</p><pre><code class="language-julia-repl hljs">julia&gt; path_koma = dirname(dirname(pathof(KomaMRI)))
julia&gt; path_spiral = joinpath(path_koma, &quot;examples&quot;, &quot;1.sequences&quot;, &quot;spiral.seq&quot;)
julia&gt; spiral = read_seq(path_spiral)
julia&gt; plot_seq(spiral)
julia&gt; plot_kspace(spiral)</code></pre><object type="text/html" data="../../assets/seq-spiral-pulseq-time.html" style="width:50%; height:420px;"></object><object type="text/html" data="../../assets/seq-spiral-pulseq-kspace.html" style="width:50%; height:420px;"></object><h2 id="Running-Simulation"><a class="docs-heading-anchor" href="#Running-Simulation">Running Simulation</a><a id="Running-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Simulation" title="Permalink"></a></h2><p>(You can also go to <a href="../2-1-use-koma-ui/#Running-Simulation">analog steps using UI</a>)</p><p>The following lines in the example script configure and perform the simulation:</p><pre><code class="language-julia hljs"># Define simulation parameters and perform simulation
sim_params = KomaMRICore.default_sim_params() 
raw = simulate(obj, seq, sys; sim_params)</code></pre><h3 id="Simulation-Parameters"><a class="docs-heading-anchor" href="#Simulation-Parameters">Simulation Parameters</a><a id="Simulation-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-Parameters" title="Permalink"></a></h3><p>To perform simulations, <strong>KomaMRI</strong> requires certain parameters. You can use the default parameters for testing, but you also have the option to customize specific simulation aspects. In the example, we use the <a href="../../reference/3-koma-core/#KomaMRICore.default_sim_params"><code>KomaMRICore.default_sim_params</code></a> function to create a dictionary with default simulation parameters. You can view the keys that can be modified by displaying the <code>sim_params</code> variable:</p><pre><code class="language-julia-repl hljs">julia&gt; sim_params
Dict{String, Any} with 9 entries:
  &quot;return_type&quot; =&gt; &quot;raw&quot;
  &quot;Nblocks&quot;     =&gt; 20
  &quot;gpu&quot;         =&gt; true
  &quot;Nthreads&quot;    =&gt; 1
  &quot;gpu_device&quot;  =&gt; 0
  &quot;sim_method&quot;  =&gt; Bloch()
  &quot;precision&quot;   =&gt; &quot;f32&quot;
  &quot;Œît&quot;          =&gt; 0.001
  &quot;Œît_rf&quot;       =&gt; 5.0e-5</code></pre><p>All of these parameters deserve special attention. We will explain some of the most important ones here. For instance, <code>&quot;Œît&quot;</code> and <code>&quot;Œît_rf&quot;</code> represent the raster times for the gradients and RFs. <code>&quot;return_type&quot;</code> specifies the type of variable returned by the simulator (by default, it returns an object ready for use with <strong>MRIReco</strong> for reconstruction, but you can use the value <code>&quot;mat&quot;</code> to return a simple vector). <code>&quot;gpu&quot;</code> indicates whether you want to use your GPU device for simulations, and <code>&quot;precision&quot;</code> sets the floating-point precision. For more details on how to set these parameters, please refer to the <a href="../../explanation/6-simulation/">Simulation Parameters Section</a>.</p><h3 id="Raw-Signal"><a class="docs-heading-anchor" href="#Raw-Signal">Raw Signal</a><a id="Raw-Signal-1"></a><a class="docs-heading-anchor-permalink" href="#Raw-Signal" title="Permalink"></a></h3><p>The simulation is performed using the <a href="../../reference/3-koma-core/#KomaMRICore.simulate"><code>simulate</code></a> function, which requires three arguments: a <strong>Scanner</strong> struct, a <strong>Phantom</strong> struct, and a <strong>Sequence</strong> struct. Optionally, you can include the keyword argument <code>sim_params</code> if you wish to use custom simulation parameters.</p><p>In the example, we can see that the output of the simulation is a special struct:</p><pre><code class="language-julia-repl hljs">julia&gt; typeof(raw)
RawAcquisitionData

julia&gt; raw
RawAcquisitionData[SeqName: epi | 101 Profile(s) of 101√ó1]</code></pre><p>You can plot the simulation result with the <a href="../../reference/5-koma-plots/#KomaMRIPlots.plot_signal"><code>plot_signal</code></a> function like so:</p><pre><code class="language-julia-repl hljs">julia&gt; plot_signal(raw)</code></pre><object type="text/html" data="../../assets/raw-epi-brain-default.html" style="width:100%; height:420px;"></object><h2 id="Reconstructing-Image-using-MRIReco"><a class="docs-heading-anchor" href="#Reconstructing-Image-using-MRIReco">Reconstructing Image using MRIReco</a><a id="Reconstructing-Image-using-MRIReco-1"></a><a class="docs-heading-anchor-permalink" href="#Reconstructing-Image-using-MRIReco" title="Permalink"></a></h2><p>(You can also go to <a href="../2-1-use-koma-ui/#Reconstructing-Image-using-MRIReco">analog steps using UI</a>)</p><p><strong>KomaMRI</strong> does not handle reconstruction; instead, you should utilize the <strong>MRIReco</strong> package to generate an image. For convenience, when you install <strong>KomaMRI</strong>, you also install <strong>MRIReco</strong>, allowing you to access functions from that package. You should pay special attention to the <code>RawAcquisitionData</code> and <code>AcquisitionData</code> structs, as well as the <code>reconstruction</code> function.</p><p>In the example below, we define an auxiliary function, <code>reconstruct_2d_image</code>, which takes a raw signal struct, <code>RawAcquisitionData</code>, as input and returns a 2D Array representing an image. Within this function, we create an <code>AcquisitionData</code> struct and set some reconstruction parameters, which serve as inputs for the <code>reconstruction</code> function. The latter function is responsible for the image generation process.</p><pre><code class="language-julia hljs"># Auxiliary function for reconstruction
function reconstruct_2d_image(raw::RawAcquisitionData)
    acqData = AcquisitionData(raw)
    acqData.traj[1].circular = false #Removing circular window
    C = maximum(2*abs.(acqData.traj[1].nodes[:]))  #Normalize k-space to -.5 to .5 for NUFFT
    acqData.traj[1].nodes = acqData.traj[1].nodes[1:2,:] ./ C
    Nx, Ny = raw.params[&quot;reconSize&quot;][1:2]
    recParams = Dict{Symbol,Any}()
    recParams[:reconSize] = (Nx, Ny)
    recParams[:densityWeighting] = true
    rec = reconstruction(acqData, recParams)
    image3d  = reshape(rec.data, Nx, Ny, :)
    image2d = (abs.(image3d) * prod(size(image3d)[1:2]))[:,:,1]
    return image2d
end

# Perform reconstruction to get the image
image = reconstruct_2d_image(raw)</code></pre><p>If you need more information about how to use the <code>AcquisitionData</code> and the how to fill the reconstruction parameters, you need to visit the <a href="https://github.com/MagneticResonanceImaging/MRIReco.jl">MRIReco webpage</a>).</p><p>To display the image, you can use the <a href="../../reference/5-koma-plots/#KomaMRIPlots.plot_image"><code>plot_image</code></a> function which is part of the <strong>KomaMRIPlots</strong> subpackage:</p><pre><code class="language-julia-repl hljs">julia&gt; plot_image(image)</code></pre><center><object type="text/html" data="../../assets/image-default-brain.html" style="width:100%; height:620px;"></object></center><h2 id="Exporting-Results-to-.mat-File"><a class="docs-heading-anchor" href="#Exporting-Results-to-.mat-File">Exporting Results to .mat File</a><a id="Exporting-Results-to-.mat-File-1"></a><a class="docs-heading-anchor-permalink" href="#Exporting-Results-to-.mat-File" title="Permalink"></a></h2><p>(You can also go to <a href="../2-1-use-koma-ui/#Exporting-Results-to-.mat-File">analog steps using UI</a>)</p><p>Many people in the MRI community uses MATLAB, probably you are one of them and you want to process the raw signal in the MATLAB environment after simulation is done with <strong>KomaMRI</strong>. Here we show you an example of how to save a <code>.mat</code> file with the information of the raw signal thank to the help of the <strong>MAT</strong> package:</p><p>Many people in the MRI community use <strong>MATLAB</strong>; you might be one of them and may want to process the <strong>Raw Signal</strong> in the <strong>MATLAB</strong> environment after simulation is completed with <strong>KomaMRI</strong>. Here, we provide an example of how to save a <code>.mat</code> file containing the  <strong>Raw Signal</strong> information using the <strong>MAT</strong> package.</p><pre><code class="language-julia hljs"># Use the MAT package
using MAT

# Perform simulation to return an Array type
sim_params[&quot;return_type&quot;] = &quot;mat&quot;
raw = simulate(obj, seq, sys; sim_params)

# Save the .mat file in the temp directory
matwrite(joinpath(tempdir(), &quot;koma-raw.mat&quot;), Dict(&quot;raw&quot; =&gt; raw))</code></pre><p>Note that we need to simulate to return an array type (not the default <code>RawAcquisitionData</code>), and then we utilize the <code>matwrite</code> function to save a file named &quot;koma-raw.mat&quot; in your computer&#39;s temporary directory. Now, you can navigate to your temporary directory (which you can find by displaying the result of <code>tempdir()</code> in the <strong>Julia REPL</strong>) and locate the &quot;koma-raw.mat&quot; file.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../2-2-use-koma-notebooks/">¬´ Use Koma in Notebooks</a><a class="docs-footer-nextpage" href="../3-create-your-own-phantom/">Create Your Own Phantom ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 14 February 2026 23:52">Saturday 14 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
